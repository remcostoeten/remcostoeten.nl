---
title: 'Shipping Smarter: How I Built My Draft System for MDX'
publishedAt: '2025-12-20'
summary: 'Ever push a half-finished post because you accidentally saved it to the main branch? Me too. Here’s how I implemented a secure draft system using MDX frontmatter and Better-Auth.'
categories: [Engineering, Next.js, Auth]
draft: true
---

Building a blog with MDX is great because it feels like writing, not "content management." But it usually lacks some table-stakes features of a traditional CMS—like drafts.

I recently decided to fix that. Since I'm already using **Better-Auth** with a custom admin role, it made sense to leverage that security for my development workflow.

## The Goal
1. Mark a post as a draft via frontmatter.
2. Hide drafts from the public blog listing.
3. Allow me (the admin) to preview them while logged in.
4. Prevent direct access to draft URLs by unauthorized users.

## Step 1: Parsing the Frontmatter
The first step was updating my MDX parser to recognize a `draft` field.

```typescript
// src/utils/utils.ts
case 'draft':
  metadata.draft = value.toLowerCase() === 'true'
  break
```

I also split my blog fetching logic into `getBlogPosts()` (public) and `getAllBlogPosts()` (admin/internal).

## Step 2: The Security Layer
I created a simple server-only utility to check for admin status. Since I'm using the `better-auth` admin plugin, it's as simple as:

```typescript
export async function isAdmin() {
    const session = await auth.api.getSession({ headers: await headers() })
    return session?.user?.role === 'admin' || session?.user?.email === 'remcostoeten@gmail.com'
}
```

## Step 3: Protecting the Routes
In my dynamic blog route `[...slug]`, I added a check before rendering. If the post is a draft and the user isn't an admin, they get a `404`.

```tsx
const userIsAdmin = await isAdmin()
const allPosts = userIsAdmin ? getAllBlogPosts() : getBlogPosts()
const post = allPosts.find((p) => p.slug === slug)

if (!post || (post.metadata.draft && !userIsAdmin)) {
  notFound()
}
```

## Step 4: The Developer Experience
To make it clear when I'm viewing a draft, I added a subtle amber banner at the top of the page and a "DRAFT" badge in the listing.

This post you're reading right now? It's currently set to `draft: true`. If you can see this, you're either me or I've finally decided to hit publish.

## Why this matters
Good developer experience isn't just about the tools you use; it's about the safety rails you build for yourself. This system allows me to write freely, commit as I go, and only "release" when the post is actually ready—all within a Git-based workflow.

What's next? Probably implementing reaction counts and view tracking in the database, but for today, I'm happy with my safe haven for unfinished thoughts.
